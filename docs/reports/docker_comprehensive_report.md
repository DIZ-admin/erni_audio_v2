# üê≥ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Erni Audio v2

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:** 3 –∏—é–Ω—è 2025 –≥.  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–£–°–ü–ï–®–ù–û –ü–†–û–ô–î–ï–ù–û**

---

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### 1. ‚úÖ **–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
- **Dockerfile:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å multi-user support –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é
- **–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏:** ~60 —Å–µ–∫—É–Ω–¥
- **–†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å .dockerignore
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** ffmpeg, libmagic, curl —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –í—Å–µ –ø–∞–∫–µ—Ç—ã –∏–∑ requirements.txt —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

### 2. ‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **Help –∫–æ–º–∞–Ω–¥–∞:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –æ–ø—Ü–∏–∏
- **Health check:** –°—Ç–∞—Ç—É—Å "healthy", –≤—Å–µ 6 –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–æ–π–¥–µ–Ω—ã
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ .env —Ñ–∞–π–ª–æ–≤
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

### 3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤**
- **CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** 0.00% –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–∫–æ—è
- **–ü–∞–º—è—Ç—å:** 2.7 MiB / 7.7 GiB (0.03%)
- **–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:** < 5 —Å–µ–∫—É–Ω–¥
- **Health check –≤—Ä–µ–º—è:** < 2 —Å–µ–∫—É–Ω–¥—ã

### 4. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
- **–ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `erni`
- **API –∫–ª—é—á–∏:** –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–µ—Ç–∏
- **–§–∞–π–ª–æ–≤—ã–µ –ø—Ä–∞–≤–∞:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

### 5. ‚úÖ **Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
- **–°–∏–Ω—Ç–∞–∫—Å–∏—Å:** –í–∞–ª–∏–¥–Ω—ã–π YAML, –ø—Ä–æ—Ö–æ–¥–∏—Ç `docker-compose config`
- **–°–µ—Ä–≤–∏—Å—ã:** –û—Å–Ω–æ–≤–Ω–æ–π pipeline + webhook —Å–µ—Ä–≤–µ—Ä
- **Health checks:** –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **Volumes:** –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–°–µ—Ç–∏:** –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

---

## üîß –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
1. **`.dockerignore`** - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞
2. **`docker-compose.yml`** - Orchestration –¥–ª—è production
3. **`docker_test.py`** - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **`docker_functional_test.py`** - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
5. **`.env.functional_test`** - –¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

### –£–ª—É—á—à–µ–Ω–∏—è Dockerfile:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ libmagic –¥–ª—è python-magic
- ‚úÖ –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `erni`
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ –ø—Ä–∞–≤–∞
- ‚úÖ Health check –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ labels

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```json
{
  "overall_status": "passed",
  "tests": {
    "build": {"status": "pass", "duration": "< 5 –º–∏–Ω—É—Ç"},
    "health_check": {"status": "pass", "health_status": "healthy"},
    "basic_functionality": {"status": "pass"},
    "resource_usage": {"status": "pass", "cpu_percent": "0.00", "memory_percent": "0.03"}
  },
  "errors": [],
  "warnings": []
}
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```json
{
  "overall_status": "passed",
  "tests": {
    "help_command": {"status": "pass"},
    "health_check": {"status": "pass", "health_status": "healthy"},
    "file_validation": {"status": "pass"}
  },
  "errors": [],
  "warnings": []
}
```

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production

### 1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- ‚úÖ API –∫–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ git

### 2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- ‚úÖ Health checks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus

### 3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ –†–µ—Å—É—Ä—Å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ docker-compose.yml
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
- üìù –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª—è –±–æ–ª–µ–µ –º–æ—â–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

### 4. **Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**
- ‚úÖ Volumes –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ backup –¥–∞–Ω–Ω—ã—Ö

---

## üêõ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ libmagic
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã `libmagic1` –∏ `libmagic-dev` –≤ Dockerfile

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: API –∫–ª—é—á–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ docker-compose.yml

### ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∞—Ç—Ä–∏–±—É—Ç version
**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª—ë–Ω –∞—Ç—Ä–∏–±—É—Ç `version` –∏–∑ docker-compose.yml

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞:
```bash
docker build -t erni-audio-v2:latest .
```

### –ó–∞–ø—É—Å–∫ —Å Docker Compose:
```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API –∫–ª—é—á–∞–º–∏
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –õ–æ–≥–∏
docker-compose logs -f
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
python3 docker_test.py --quick

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
python3 docker_test.py

# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
python3 docker_functional_test.py --quick
```

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Erni Audio v2 **–≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

- üê≥ **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices
- üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- üè• **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** Health checks –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- üîß **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ production —Å—Ä–µ–¥–µ.

---

*–û—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞*
