# üß™ –¢–µ—Å—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ Erni Audio v2

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤ –∏ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ reports/                    # üìä –û—Ç—á–µ—Ç—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ coverage/              # HTML –æ—Ç—á–µ—Ç—ã –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ test_system_audit_report.md
‚îÇ   ‚îî‚îÄ‚îÄ junit.xml              # JUnit –æ—Ç—á–µ—Ç—ã –¥–ª—è CI/CD
‚îú‚îÄ‚îÄ assets/                    # üéµ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ samples/                   # üéµ –û–±—Ä–∞–∑—Ü—ã –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ docker_test.py             # üê≥ Docker —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ docker_functional_test.py  # üê≥ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ Docker —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ test_*.py                  # üß™ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤
```bash
python3 run_tests.py --quick
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
python3 run_tests.py --all
```

### –ó–∞–ø—É—Å–∫ Docker —Ç–µ—Å—Ç–æ–≤
```bash
python3 run_tests.py --docker
```

## üìã –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### üß™ Unit —Ç–µ—Å—Ç—ã
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~30 —Å–µ–∫—É–Ω–¥  
**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python3 run_tests.py --unit
# –∏–ª–∏
python3 -m pytest tests/ -m "unit or not (integration or slow or docker)"
```

### üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–µ—Å—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~60 —Å–µ–∫—É–Ω–¥  
**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python3 run_tests.py --integration
# –∏–ª–∏
python3 -m pytest tests/ -m "integration and not real_api"
```

### ‚ö° –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–µ—Å—Ç—ã —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~45 —Å–µ–∫—É–Ω–¥  
**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python3 run_tests.py --performance
# –∏–ª–∏
python3 -m pytest tests/ -m "performance or slow"
```

### üê≥ Docker —Ç–µ—Å—Ç—ã
**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–µ—Å—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~40 —Å–µ–∫—É–Ω–¥  
**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python3 run_tests.py --docker
# –∏–ª–∏
python3 tests/docker_test.py --quick
python3 tests/docker_functional_test.py --quick
```

### üåê –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API
**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–µ—Å—Ç—ã —Å –Ω–∞—Å—Ç–æ—è—â–∏–º–∏ API –∫–ª—é—á–∞–º–∏  
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –§–∞–π–ª .env —Å API –∫–ª—é—á–∞–º–∏  
**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python3 run_tests.py --integration --real-api
# –∏–ª–∏
python3 -m pytest tests/ -m "real_api"
```

## üè∑Ô∏è –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

| –ú–∞—Ä–∫–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
|--------|----------|------------------|
| `unit` | –ë—ã—Å—Ç—Ä—ã–µ unit —Ç–µ—Å—Ç—ã | < 1 —Å–µ–∫ |
| `integration` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã | 1-10 —Å–µ–∫ |
| `performance` | –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ | 5-30 —Å–µ–∫ |
| `slow` | –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã | > 10 —Å–µ–∫ |
| `docker` | Docker —Ç–µ—Å—Ç—ã | 10-60 —Å–µ–∫ |
| `api` | –¢–µ—Å—Ç—ã API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ | 1-5 —Å–µ–∫ |
| `stress` | –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã | > 30 —Å–µ–∫ |
| `real_api` | –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API | 5-30 —Å–µ–∫ |

## üìä –û—Ç—á–µ—Ç—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –ø–æ–∫—Ä—ã—Ç–∏—è
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pytest-cov (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
pip install pytest-cov

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
python3 -m pytest tests/ --cov=pipeline --cov-report=html:tests/reports/coverage
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤
```bash
# HTML –æ—Ç—á–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏—è
open tests/reports/coverage/index.html

# –ê—É–¥–∏—Ç —Ç–µ—Å—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
cat tests/reports/test_system_audit_report.md
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### pytest.ini
–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `pytest.ini`:
- –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—É—Ç–∏ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
- –§–∏–ª—å—Ç—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –î–ª—è —Ç–µ—Å—Ç–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API
export OPENAI_API_KEY="your-key"
export PYANNOTE_API_KEY="your-key"
export REPLICATE_API_TOKEN="your-token"
```

## üê≥ Docker —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–µ Docker —Ç–µ—Å—Ç—ã
```bash
python3 tests/docker_test.py --quick
```

### –ü–æ–ª–Ω—ã–µ Docker —Ç–µ—Å—Ç—ã
```bash
python3 tests/docker_test.py --full
python3 tests/docker_functional_test.py --full
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .env —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç API –∫–ª—é—á–∏
python3 tests/docker_functional_test.py --real-api
```

## üöÄ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### GitHub Actions
```yaml
- name: Run tests
  run: |
    python3 run_tests.py --all
    
- name: Upload test reports
  uses: actions/upload-artifact@v3
  with:
    name: test-reports
    path: tests/reports/
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
python3 run_tests.py --quick

# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
python3 run_tests.py --all
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 224
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 97.3% (218/224)
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞:** ~85%
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** < 1 –º–∏–Ω—É—Ç—ã

### –¶–µ–ª–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ > 80%
- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å > 95%
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è < 2 –º–∏–Ω—É—Ç
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
```python
import pytest
from unittest.mock import patch, MagicMock
from pipeline.your_agent import YourAgent

class TestYourAgent:
    """–¢–µ—Å—Ç—ã –¥–ª—è YourAgent"""
    
    @pytest.mark.unit
    def test_basic_functionality(self):
        """–ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏"""
        agent = YourAgent("test-key")
        result = agent.some_method()
        assert result is not None
        
    @pytest.mark.integration
    def test_integration_with_api(self):
        """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å API"""
        # –¢–µ—Å—Ç —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º API
        pass
```

### –°–æ–≥–ª–∞—à–µ–Ω–∏—è –ø–æ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—é
- –§–∞–π–ª—ã: `test_component_name.py`
- –ö–ª–∞—Å—Å—ã: `TestComponentName`
- –ú–µ—Ç–æ–¥—ã: `test_specific_functionality`
- –ú–∞—Ä–∫–µ—Ä—ã: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∏–ø —Ç–µ—Å—Ç–∞

## üîç –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
```bash
python3 -m pytest tests/test_transcription_agent.py::test_init -v
```

### –û—Ç–ª–∞–¥–∫–∞ –ø–∞–¥–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤
```bash
python3 -m pytest tests/ --tb=long --pdb
```

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
```bash
python3 -m pytest tests/ --durations=10
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å —Ç–µ—Å—Ç–∞–º–∏:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞:** `tests/reports/test_system_audit_report.md`
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:** `python3 run_tests.py --quick -v`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:** `tests/reports/`
4. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** –≠—Ç–æ—Ç —Ñ–∞–π–ª

---

**–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:** ‚úÖ **–ì–û–¢–û–í–ê –ö PRODUCTION**  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-06-03
